/**
 * @license
 * Copyright 2015 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

(function () {
  'use strict';

  /**
   * Class constructor for Textfield MDL component.
   * Implements MDL component design pattern defined at:
   * https://github.com/jasonmayes/mdl-component-design-pattern
   *
   * @constructor
   * @param {HTMLElement} element The element that will be upgraded.
   */

  var MaterialTextfield = function MaterialTextfield(element) {
    this.element_ = element;
    this.maxRows = this.Constant_.NO_MAX_ROWS;
    // Initialize instance.
    this.init();
  };
  window['MaterialTextfield'] = MaterialTextfield;

  /**
   * Store constants in one place so they can be updated easily.
   *
   * @enum {string | number}
   * @private
   */
  MaterialTextfield.prototype.Constant_ = {
    NO_MAX_ROWS: -1,
    MAX_ROWS_ATTRIBUTE: 'maxrows'
  };

  /**
   * Store strings for class names defined by this component that are used in
   * JavaScript. This allows us to simply change it in one place should we
   * decide to modify at a later date.
   *
   * @enum {string}
   * @private
   */
  MaterialTextfield.prototype.CssClasses_ = {
    LABEL: 'mdl-textfield__label',
    INPUT: 'mdl-textfield__input',
    IS_DIRTY: 'is-dirty',
    IS_FOCUSED: 'is-focused',
    IS_DISABLED: 'is-disabled',
    IS_INVALID: 'is-invalid',
    IS_UPGRADED: 'is-upgraded',
    HAS_PLACEHOLDER: 'has-placeholder'
  };

  /**
   * Handle input being entered.
   *
   * @param {Event} event The event that fired.
   * @private
   */
  MaterialTextfield.prototype.onKeyDown_ = function (event) {
    var currentRowCount = event.target.value.split('\n').length;
    if (event.keyCode === 13) {
      if (currentRowCount >= this.maxRows) {
        event.preventDefault();
      }
    }
  };

  /**
   * Handle focus.
   *
   * @param {Event} event The event that fired.
   * @private
   */
  MaterialTextfield.prototype.onFocus_ = function (event) {
    this.element_.classList.add(this.CssClasses_.IS_FOCUSED);
  };

  /**
   * Handle lost focus.
   *
   * @param {Event} event The event that fired.
   * @private
   */
  MaterialTextfield.prototype.onBlur_ = function (event) {
    this.element_.classList.remove(this.CssClasses_.IS_FOCUSED);
  };

  /**
   * Handle reset event from out side.
   *
   * @param {Event} event The event that fired.
   * @private
   */
  MaterialTextfield.prototype.onReset_ = function (event) {
    this.updateClasses_();
  };

  /**
   * Handle class updates.
   *
   * @private
   */
  MaterialTextfield.prototype.updateClasses_ = function () {
    this.checkDisabled();
    this.checkValidity();
    this.checkDirty();
    this.checkFocus();
  };

  // Public methods.

  /**
   * Check the disabled state and update field accordingly.
   *
   * @public
   */
  MaterialTextfield.prototype.checkDisabled = function () {
    if (this.input_.disabled) {
      this.element_.classList.add(this.CssClasses_.IS_DISABLED);
    } else {
      this.element_.classList.remove(this.CssClasses_.IS_DISABLED);
    }
  };
  MaterialTextfield.prototype['checkDisabled'] = MaterialTextfield.prototype.checkDisabled;

  /**
  * Check the focus state and update field accordingly.
  *
  * @public
  */
  MaterialTextfield.prototype.checkFocus = function () {
    if (Boolean(this.element_.querySelector(':focus'))) {
      this.element_.classList.add(this.CssClasses_.IS_FOCUSED);
    } else {
      this.element_.classList.remove(this.CssClasses_.IS_FOCUSED);
    }
  };
  MaterialTextfield.prototype['checkFocus'] = MaterialTextfield.prototype.checkFocus;

  /**
   * Check the validity state and update field accordingly.
   *
   * @public
   */
  MaterialTextfield.prototype.checkValidity = function () {
    if (this.input_.validity) {
      if (this.input_.validity.valid) {
        this.element_.classList.remove(this.CssClasses_.IS_INVALID);
      } else {
        this.element_.classList.add(this.CssClasses_.IS_INVALID);
      }
    }
  };
  MaterialTextfield.prototype['checkValidity'] = MaterialTextfield.prototype.checkValidity;

  /**
   * Check the dirty state and update field accordingly.
   *
   * @public
   */
  MaterialTextfield.prototype.checkDirty = function () {
    if (this.input_.value && this.input_.value.length > 0) {
      this.element_.classList.add(this.CssClasses_.IS_DIRTY);
    } else {
      this.element_.classList.remove(this.CssClasses_.IS_DIRTY);
    }
  };
  MaterialTextfield.prototype['checkDirty'] = MaterialTextfield.prototype.checkDirty;

  /**
   * Disable text field.
   *
   * @public
   */
  MaterialTextfield.prototype.disable = function () {
    this.input_.disabled = true;
    this.updateClasses_();
  };
  MaterialTextfield.prototype['disable'] = MaterialTextfield.prototype.disable;

  /**
   * Enable text field.
   *
   * @public
   */
  MaterialTextfield.prototype.enable = function () {
    this.input_.disabled = false;
    this.updateClasses_();
  };
  MaterialTextfield.prototype['enable'] = MaterialTextfield.prototype.enable;

  /**
   * Update text field value.
   *
   * @param {string} value The value to which to set the control (optional).
   * @public
   */
  MaterialTextfield.prototype.change = function (value) {

    this.input_.value = value || '';
    this.updateClasses_();
  };
  MaterialTextfield.prototype['change'] = MaterialTextfield.prototype.change;

  /**
   * Initialize element.
   */
  MaterialTextfield.prototype.init = function () {

    if (this.element_) {
      this.label_ = this.element_.querySelector('.' + this.CssClasses_.LABEL);
      this.input_ = this.element_.querySelector('.' + this.CssClasses_.INPUT);

      if (this.input_) {
        if (this.input_.hasAttribute(
        /** @type {string} */this.Constant_.MAX_ROWS_ATTRIBUTE)) {
          this.maxRows = parseInt(this.input_.getAttribute(
          /** @type {string} */this.Constant_.MAX_ROWS_ATTRIBUTE), 10);
          if (isNaN(this.maxRows)) {
            this.maxRows = this.Constant_.NO_MAX_ROWS;
          }
        }

        if (this.input_.hasAttribute('placeholder')) {
          this.element_.classList.add(this.CssClasses_.HAS_PLACEHOLDER);
        }

        this.boundUpdateClassesHandler = this.updateClasses_.bind(this);
        this.boundFocusHandler = this.onFocus_.bind(this);
        this.boundBlurHandler = this.onBlur_.bind(this);
        this.boundResetHandler = this.onReset_.bind(this);
        this.input_.addEventListener('input', this.boundUpdateClassesHandler);
        this.input_.addEventListener('focus', this.boundFocusHandler);
        this.input_.addEventListener('blur', this.boundBlurHandler);
        this.input_.addEventListener('reset', this.boundResetHandler);

        if (this.maxRows !== this.Constant_.NO_MAX_ROWS) {
          // TODO: This should handle pasting multi line text.
          // Currently doesn't.
          this.boundKeyDownHandler = this.onKeyDown_.bind(this);
          this.input_.addEventListener('keydown', this.boundKeyDownHandler);
        }
        var invalid = this.element_.classList.contains(this.CssClasses_.IS_INVALID);
        this.updateClasses_();
        this.element_.classList.add(this.CssClasses_.IS_UPGRADED);
        if (invalid) {
          this.element_.classList.add(this.CssClasses_.IS_INVALID);
        }
        if (this.input_.hasAttribute('autofocus')) {
          this.element_.focus();
          this.checkFocus();
        }
      }
    }
  };

  // The component registers itself. It can assume componentHandler is available
  // in the global scope.
  componentHandler.register({
    constructor: MaterialTextfield,
    classAsString: 'MaterialTextfield',
    cssClass: 'mdl-js-textfield',
    widget: true
  });
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRleHRmaWVsZC5qcyJdLCJuYW1lcyI6WyJNYXRlcmlhbFRleHRmaWVsZCIsImVsZW1lbnQiLCJlbGVtZW50XyIsIm1heFJvd3MiLCJDb25zdGFudF8iLCJOT19NQVhfUk9XUyIsImluaXQiLCJ3aW5kb3ciLCJwcm90b3R5cGUiLCJNQVhfUk9XU19BVFRSSUJVVEUiLCJDc3NDbGFzc2VzXyIsIkxBQkVMIiwiSU5QVVQiLCJJU19ESVJUWSIsIklTX0ZPQ1VTRUQiLCJJU19ESVNBQkxFRCIsIklTX0lOVkFMSUQiLCJJU19VUEdSQURFRCIsIkhBU19QTEFDRUhPTERFUiIsIm9uS2V5RG93bl8iLCJldmVudCIsImN1cnJlbnRSb3dDb3VudCIsInRhcmdldCIsInZhbHVlIiwic3BsaXQiLCJsZW5ndGgiLCJrZXlDb2RlIiwicHJldmVudERlZmF1bHQiLCJvbkZvY3VzXyIsImNsYXNzTGlzdCIsImFkZCIsIm9uQmx1cl8iLCJyZW1vdmUiLCJvblJlc2V0XyIsInVwZGF0ZUNsYXNzZXNfIiwiY2hlY2tEaXNhYmxlZCIsImNoZWNrVmFsaWRpdHkiLCJjaGVja0RpcnR5IiwiY2hlY2tGb2N1cyIsImlucHV0XyIsImRpc2FibGVkIiwiQm9vbGVhbiIsInF1ZXJ5U2VsZWN0b3IiLCJ2YWxpZGl0eSIsInZhbGlkIiwiZGlzYWJsZSIsImVuYWJsZSIsImNoYW5nZSIsImxhYmVsXyIsImhhc0F0dHJpYnV0ZSIsInBhcnNlSW50IiwiZ2V0QXR0cmlidXRlIiwiaXNOYU4iLCJib3VuZFVwZGF0ZUNsYXNzZXNIYW5kbGVyIiwiYmluZCIsImJvdW5kRm9jdXNIYW5kbGVyIiwiYm91bmRCbHVySGFuZGxlciIsImJvdW5kUmVzZXRIYW5kbGVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsImJvdW5kS2V5RG93bkhhbmRsZXIiLCJpbnZhbGlkIiwiY29udGFpbnMiLCJmb2N1cyIsImNvbXBvbmVudEhhbmRsZXIiLCJyZWdpc3RlciIsImNvbnN0cnVjdG9yIiwiY2xhc3NBc1N0cmluZyIsImNz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UTtBQUpnQixHQUExQjtBQU1ELENBMVFEIiwiZmlsZSI6InRleHRmaWVsZC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE1IEdvb2dsZSBJbmMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG4oZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICAvKipcbiAgICogQ2xhc3MgY29uc3RydWN0b3IgZm9yIFRleHRmaWVsZCBNREwgY29tcG9uZW50LlxuICAgKiBJbXBsZW1lbnRzIE1ETCBjb21wb25lbnQgZGVzaWduIHBhdHRlcm4gZGVmaW5lZCBhdDpcbiAgICogaHR0cHM6Ly9naXRodWIuY29tL2phc29ubWF5ZXMvbWRsLWNvbXBvbmVudC1kZXNpZ24tcGF0dGVyblxuICAgKlxuICAgKiBAY29uc3RydWN0b3JcbiAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gZWxlbWVudCBUaGUgZWxlbWVudCB0aGF0IHdpbGwgYmUgdXBncmFkZWQuXG4gICAqL1xuICB2YXIgTWF0ZXJpYWxUZXh0ZmllbGQgPSBmdW5jdGlvbiBNYXRlcmlhbFRleHRmaWVsZChlbGVtZW50KSB7XG4gICAgdGhpcy5lbGVtZW50XyA9IGVsZW1lbnQ7XG4gICAgdGhpcy5tYXhSb3dzID0gdGhpcy5Db25zdGFudF8uTk9fTUFYX1JPV1M7XG4gICAgLy8gSW5pdGlhbGl6ZSBpbnN0YW5jZS5cbiAgICB0aGlzLmluaXQoKTtcbiAgfTtcbiAgd2luZG93WydNYXRlcmlhbFRleHRmaWVsZCddID0gTWF0ZXJpYWxUZXh0ZmllbGQ7XG5cbiAgLyoqXG4gICAqIFN0b3JlIGNvbnN0YW50cyBpbiBvbmUgcGxhY2Ugc28gdGhleSBjYW4gYmUgdXBkYXRlZCBlYXNpbHkuXG4gICAqXG4gICAqIEBlbnVtIHtzdHJpbmcgfCBudW1iZXJ9XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBNYXRlcmlhbFRleHRmaWVsZC5wcm90b3R5cGUuQ29uc3RhbnRfID0ge1xuICAgIE5PX01BWF9ST1dTOiAtMSxcbiAgICBNQVhfUk9XU19BVFRSSUJVVEU6ICdtYXhyb3dzJ1xuICB9O1xuXG4gIC8qKlxuICAgKiBTdG9yZSBzdHJpbmdzIGZvciBjbGFzcyBuYW1lcyBkZWZpbmVkIGJ5IHRoaXMgY29tcG9uZW50IHRoYXQgYXJlIHVzZWQgaW5cbiAgICogSmF2YVNjcmlwdC4gVGhpcyBhbGxvd3MgdXMgdG8gc2ltcGx5IGNoYW5nZSBpdCBpbiBvbmUgcGxhY2Ugc2hvdWxkIHdlXG4gICAqIGRlY2lkZSB0byBtb2RpZnkgYXQgYSBsYXRlciBkYXRlLlxuICAgKlxuICAgKiBAZW51bSB7c3RyaW5nfVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgTWF0ZXJpYWxUZXh0ZmllbGQucHJvdG90eXBlLkNzc0NsYXNzZXNfID0ge1xuICAgIExBQkVMOiAnbWRsLXRleHRmaWVsZF9fbGFiZWwnLFxuICAgIElOUFVUOiAnbWRsLXRleHRmaWVsZF9faW5wdXQnLFxuICAgIElTX0RJUlRZOiAnaXMtZGlydHknLFxuICAgIElTX0ZPQ1VTRUQ6ICdpcy1mb2N1c2VkJyxcbiAgICBJU19ESVNBQkxFRDogJ2lzLWRpc2FibGVkJyxcbiAgICBJU19JTlZBTElEOiAnaXMtaW52YWxpZCcsXG4gICAgSVNfVVBHUkFERUQ6ICdpcy11cGdyYWRlZCcsXG4gICAgSEFTX1BMQUNFSE9MREVSOiAnaGFzLXBsYWNlaG9sZGVyJ1xuICB9O1xuXG4gIC8qKlxuICAgKiBIYW5kbGUgaW5wdXQgYmVpbmcgZW50ZXJlZC5cbiAgICpcbiAgICogQHBhcmFtIHtFdmVudH0gZXZlbnQgVGhlIGV2ZW50IHRoYXQgZmlyZWQuXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBNYXRlcmlhbFRleHRmaWVsZC5wcm90b3R5cGUub25LZXlEb3duXyA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgdmFyIGN1cnJlbnRSb3dDb3VudCA9IGV2ZW50LnRhcmdldC52YWx1ZS5zcGxpdCgnXFxuJykubGVuZ3RoO1xuICAgIGlmIChldmVudC5rZXlDb2RlID09PSAxMykge1xuICAgICAgaWYgKGN1cnJlbnRSb3dDb3VudCA+PSB0aGlzLm1heFJvd3MpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBmb2N1cy5cbiAgICpcbiAgICogQHBhcmFtIHtFdmVudH0gZXZlbnQgVGhlIGV2ZW50IHRoYXQgZmlyZWQuXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBNYXRlcmlhbFRleHRmaWVsZC5wcm90b3R5cGUub25Gb2N1c18gPSBmdW5jdGlvbihldmVudCkge1xuICAgIHRoaXMuZWxlbWVudF8uY2xhc3NMaXN0LmFkZCh0aGlzLkNzc0NsYXNzZXNfLklTX0ZPQ1VTRUQpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBIYW5kbGUgbG9zdCBmb2N1cy5cbiAgICpcbiAgICogQHBhcmFtIHtFdmVudH0gZXZlbnQgVGhlIGV2ZW50IHRoYXQgZmlyZWQuXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBNYXRlcmlhbFRleHRmaWVsZC5wcm90b3R5cGUub25CbHVyXyA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgdGhpcy5lbGVtZW50Xy5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuQ3NzQ2xhc3Nlc18uSVNfRk9DVVNFRCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEhhbmRsZSByZXNldCBldmVudCBmcm9tIG91dCBzaWRlLlxuICAgKlxuICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudCBUaGUgZXZlbnQgdGhhdCBmaXJlZC5cbiAgICogQHByaXZhdGVcbiAgICovXG4gIE1hdGVyaWFsVGV4dGZpZWxkLnByb3RvdHlwZS5vblJlc2V0XyA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgdGhpcy51cGRhdGVDbGFzc2VzXygpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBIYW5kbGUgY2xhc3MgdXBkYXRlcy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIE1hdGVyaWFsVGV4dGZpZWxkLnByb3RvdHlwZS51cGRhdGVDbGFzc2VzXyA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY2hlY2tEaXNhYmxlZCgpO1xuICAgIHRoaXMuY2hlY2tWYWxpZGl0eSgpO1xuICAgIHRoaXMuY2hlY2tEaXJ0eSgpO1xuICAgIHRoaXMuY2hlY2tGb2N1cygpO1xuICB9O1xuXG4gIC8vIFB1YmxpYyBtZXRob2RzLlxuXG4gIC8qKlxuICAgKiBDaGVjayB0aGUgZGlzYWJsZWQgc3RhdGUgYW5kIHVwZGF0ZSBmaWVsZCBhY2NvcmRpbmdseS5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKi9cbiAgTWF0ZXJpYWxUZXh0ZmllbGQucHJvdG90eXBlLmNoZWNrRGlzYWJsZWQgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5pbnB1dF8uZGlzYWJsZWQpIHtcbiAgICAgIHRoaXMuZWxlbWVudF8uY2xhc3NMaXN0LmFkZCh0aGlzLkNzc0NsYXNzZXNfLklTX0RJU0FCTEVEKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5lbGVtZW50Xy5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuQ3NzQ2xhc3Nlc18uSVNfRElTQUJMRUQpO1xuICAgIH1cbiAgfTtcbiAgTWF0ZXJpYWxUZXh0ZmllbGQucHJvdG90eXBlWydjaGVja0Rpc2FibGVkJ10gPVxuICAgICAgTWF0ZXJpYWxUZXh0ZmllbGQucHJvdG90eXBlLmNoZWNrRGlzYWJsZWQ7XG5cbiAgLyoqXG4gICogQ2hlY2sgdGhlIGZvY3VzIHN0YXRlIGFuZCB1cGRhdGUgZmllbGQgYWNjb3JkaW5nbHkuXG4gICpcbiAgKiBAcHVibGljXG4gICovXG4gIE1hdGVyaWFsVGV4dGZpZWxkLnByb3RvdHlwZS5jaGVja0ZvY3VzID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKEJvb2xlYW4odGhpcy5lbGVtZW50Xy5xdWVyeVNlbGVjdG9yKCc6Zm9jdXMnKSkpIHtcbiAgICAgIHRoaXMuZWxlbWVudF8uY2xhc3NMaXN0LmFkZCh0aGlzLkNzc0NsYXNzZXNfLklTX0ZPQ1VTRUQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmVsZW1lbnRfLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5Dc3NDbGFzc2VzXy5JU19GT0NVU0VEKTtcbiAgICB9XG4gIH07XG4gIE1hdGVyaWFsVGV4dGZpZWxkLnByb3RvdHlwZVsnY2hlY2tGb2N1cyddID1cbiAgICBNYXRlcmlhbFRleHRmaWVsZC5wcm90b3R5cGUuY2hlY2tGb2N1cztcblxuICAvKipcbiAgICogQ2hlY2sgdGhlIHZhbGlkaXR5IHN0YXRlIGFuZCB1cGRhdGUgZmllbGQgYWNjb3JkaW5nbHkuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICovXG4gIE1hdGVyaWFsVGV4dGZpZWxkLnByb3RvdHlwZS5jaGVja1ZhbGlkaXR5ID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuaW5wdXRfLnZhbGlkaXR5KSB7XG4gICAgICBpZiAodGhpcy5pbnB1dF8udmFsaWRpdHkudmFsaWQpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50Xy5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuQ3NzQ2xhc3Nlc18uSVNfSU5WQUxJRCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmVsZW1lbnRfLmNsYXNzTGlzdC5hZGQodGhpcy5Dc3NDbGFzc2VzXy5JU19JTlZBTElEKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIE1hdGVyaWFsVGV4dGZpZWxkLnByb3RvdHlwZVsnY2hlY2tWYWxpZGl0eSddID1cbiAgICAgIE1hdGVyaWFsVGV4dGZpZWxkLnByb3RvdHlwZS5jaGVja1ZhbGlkaXR5O1xuXG4gIC8qKlxuICAgKiBDaGVjayB0aGUgZGlydHkgc3RhdGUgYW5kIHVwZGF0ZSBmaWVsZCBhY2NvcmRpbmdseS5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKi9cbiAgTWF0ZXJpYWxUZXh0ZmllbGQucHJvdG90eXBlLmNoZWNrRGlydHkgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5pbnB1dF8udmFsdWUgJiYgdGhpcy5pbnB1dF8udmFsdWUubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5lbGVtZW50Xy5jbGFzc0xpc3QuYWRkKHRoaXMuQ3NzQ2xhc3Nlc18uSVNfRElSVFkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmVsZW1lbnRfLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5Dc3NDbGFzc2VzXy5JU19ESVJUWSk7XG4gICAgfVxuICB9O1xuICBNYXRlcmlhbFRleHRmaWVsZC5wcm90b3R5cGVbJ2NoZWNrRGlydHknXSA9XG4gICAgICBNYXRlcmlhbFRleHRmaWVsZC5wcm90b3R5cGUuY2hlY2tEaXJ0eTtcblxuICAvKipcbiAgICogRGlzYWJsZSB0ZXh0IGZpZWxkLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqL1xuICBNYXRlcmlhbFRleHRmaWVsZC5wcm90b3R5cGUuZGlzYWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuaW5wdXRfLmRpc2FibGVkID0gdHJ1ZTtcbiAgICB0aGlzLnVwZGF0ZUNsYXNzZXNfKCk7XG4gIH07XG4gIE1hdGVyaWFsVGV4dGZpZWxkLnByb3RvdHlwZVsnZGlzYWJsZSddID0gTWF0ZXJpYWxUZXh0ZmllbGQucHJvdG90eXBlLmRpc2FibGU7XG5cbiAgLyoqXG4gICAqIEVuYWJsZSB0ZXh0IGZpZWxkLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqL1xuICBNYXRlcmlhbFRleHRmaWVsZC5wcm90b3R5cGUuZW5hYmxlID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5pbnB1dF8uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICB0aGlzLnVwZGF0ZUNsYXNzZXNfKCk7XG4gIH07XG4gIE1hdGVyaWFsVGV4dGZpZWxkLnByb3RvdHlwZVsnZW5hYmxlJ10gPSBNYXRlcmlhbFRleHRmaWVsZC5wcm90b3R5cGUuZW5hYmxlO1xuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGV4dCBmaWVsZCB2YWx1ZS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIFRoZSB2YWx1ZSB0byB3aGljaCB0byBzZXQgdGhlIGNvbnRyb2wgKG9wdGlvbmFsKS5cbiAgICogQHB1YmxpY1xuICAgKi9cbiAgTWF0ZXJpYWxUZXh0ZmllbGQucHJvdG90eXBlLmNoYW5nZSA9IGZ1bmN0aW9uKHZhbHVlKSB7XG5cbiAgICB0aGlzLmlucHV0Xy52YWx1ZSA9IHZhbHVlIHx8ICcnO1xuICAgIHRoaXMudXBkYXRlQ2xhc3Nlc18oKTtcbiAgfTtcbiAgTWF0ZXJpYWxUZXh0ZmllbGQucHJvdG90eXBlWydjaGFuZ2UnXSA9IE1hdGVyaWFsVGV4dGZpZWxkLnByb3RvdHlwZS5jaGFuZ2U7XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemUgZWxlbWVudC5cbiAgICovXG4gIE1hdGVyaWFsVGV4dGZpZWxkLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oKSB7XG5cbiAgICBpZiAodGhpcy5lbGVtZW50Xykge1xuICAgICAgdGhpcy5sYWJlbF8gPSB0aGlzLmVsZW1lbnRfLnF1ZXJ5U2VsZWN0b3IoJy4nICsgdGhpcy5Dc3NDbGFzc2VzXy5MQUJFTCk7XG4gICAgICB0aGlzLmlucHV0XyA9IHRoaXMuZWxlbWVudF8ucXVlcnlTZWxlY3RvcignLicgKyB0aGlzLkNzc0NsYXNzZXNfLklOUFVUKTtcblxuICAgICAgaWYgKHRoaXMuaW5wdXRfKSB7XG4gICAgICAgIGlmICh0aGlzLmlucHV0Xy5oYXNBdHRyaWJ1dGUoXG4gICAgICAgICAgICAgIC8qKiBAdHlwZSB7c3RyaW5nfSAqLyAodGhpcy5Db25zdGFudF8uTUFYX1JPV1NfQVRUUklCVVRFKSkpIHtcbiAgICAgICAgICB0aGlzLm1heFJvd3MgPSBwYXJzZUludCh0aGlzLmlucHV0Xy5nZXRBdHRyaWJ1dGUoXG4gICAgICAgICAgICAgIC8qKiBAdHlwZSB7c3RyaW5nfSAqLyAodGhpcy5Db25zdGFudF8uTUFYX1JPV1NfQVRUUklCVVRFKSksIDEwKTtcbiAgICAgICAgICBpZiAoaXNOYU4odGhpcy5tYXhSb3dzKSkge1xuICAgICAgICAgICAgdGhpcy5tYXhSb3dzID0gdGhpcy5Db25zdGFudF8uTk9fTUFYX1JPV1M7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaW5wdXRfLmhhc0F0dHJpYnV0ZSgncGxhY2Vob2xkZXInKSkge1xuICAgICAgICAgIHRoaXMuZWxlbWVudF8uY2xhc3NMaXN0LmFkZCh0aGlzLkNzc0NsYXNzZXNfLkhBU19QTEFDRUhPTERFUik7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmJvdW5kVXBkYXRlQ2xhc3Nlc0hhbmRsZXIgPSB0aGlzLnVwZGF0ZUNsYXNzZXNfLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMuYm91bmRGb2N1c0hhbmRsZXIgPSB0aGlzLm9uRm9jdXNfLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMuYm91bmRCbHVySGFuZGxlciA9IHRoaXMub25CbHVyXy5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLmJvdW5kUmVzZXRIYW5kbGVyID0gdGhpcy5vblJlc2V0Xy5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLmlucHV0Xy5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIHRoaXMuYm91bmRVcGRhdGVDbGFzc2VzSGFuZGxlcik7XG4gICAgICAgIHRoaXMuaW5wdXRfLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5ib3VuZEZvY3VzSGFuZGxlcik7XG4gICAgICAgIHRoaXMuaW5wdXRfLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCB0aGlzLmJvdW5kQmx1ckhhbmRsZXIpO1xuICAgICAgICB0aGlzLmlucHV0Xy5hZGRFdmVudExpc3RlbmVyKCdyZXNldCcsIHRoaXMuYm91bmRSZXNldEhhbmRsZXIpO1xuXG4gICAgICAgIGlmICh0aGlzLm1heFJvd3MgIT09IHRoaXMuQ29uc3RhbnRfLk5PX01BWF9ST1dTKSB7XG4gICAgICAgICAgLy8gVE9ETzogVGhpcyBzaG91bGQgaGFuZGxlIHBhc3RpbmcgbXVsdGkgbGluZSB0ZXh0LlxuICAgICAgICAgIC8vIEN1cnJlbnRseSBkb2Vzbid0LlxuICAgICAgICAgIHRoaXMuYm91bmRLZXlEb3duSGFuZGxlciA9IHRoaXMub25LZXlEb3duXy5iaW5kKHRoaXMpO1xuICAgICAgICAgIHRoaXMuaW5wdXRfLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLmJvdW5kS2V5RG93bkhhbmRsZXIpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBpbnZhbGlkID0gdGhpcy5lbGVtZW50Xy5jbGFzc0xpc3RcbiAgICAgICAgICAuY29udGFpbnModGhpcy5Dc3NDbGFzc2VzXy5JU19JTlZBTElEKTtcbiAgICAgICAgdGhpcy51cGRhdGVDbGFzc2VzXygpO1xuICAgICAgICB0aGlzLmVsZW1lbnRfLmNsYXNzTGlzdC5hZGQodGhpcy5Dc3NDbGFzc2VzXy5JU19VUEdSQURFRCk7XG4gICAgICAgIGlmIChpbnZhbGlkKSB7XG4gICAgICAgICAgdGhpcy5lbGVtZW50Xy5jbGFzc0xpc3QuYWRkKHRoaXMuQ3NzQ2xhc3Nlc18uSVNfSU5WQUxJRCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaW5wdXRfLmhhc0F0dHJpYnV0ZSgnYXV0b2ZvY3VzJykpIHtcbiAgICAgICAgICB0aGlzLmVsZW1lbnRfLmZvY3VzKCk7XG4gICAgICAgICAgdGhpcy5jaGVja0ZvY3VzKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgLy8gVGhlIGNvbXBvbmVudCByZWdpc3RlcnMgaXRzZWxmLiBJdCBjYW4gYXNzdW1lIGNvbXBvbmVudEhhbmRsZXIgaXMgYXZhaWxhYmxlXG4gIC8vIGluIHRoZSBnbG9iYWwgc2NvcGUuXG4gIGNvbXBvbmVudEhhbmRsZXIucmVnaXN0ZXIoe1xuICAgIGNvbnN0cnVjdG9yOiBNYXRlcmlhbFRleHRmaWVsZCxcbiAgICBjbGFzc0FzU3RyaW5nOiAnTWF0ZXJpYWxUZXh0ZmllbGQnLFxuICAgIGNzc0NsYXNzOiAnbWRsLWpzLXRleHRmaWVsZCcsXG4gICAgd2lkZ2V0OiB0cnVlXG4gIH0pO1xufSkoKTtcbiJdfQ==
